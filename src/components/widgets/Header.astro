---
import Logo from '~/components/Logo.astro';
import ToggleMenu from '~/components/common/ToggleMenu.astro';
import { getHomePermalink } from '~/utils/permalinks';

const { id = 'header', isSticky = false, isDark = false, position = 'center' } = Astro.props;
---

<script>
  // 获取元素
  document.addEventListener('DOMContentLoaded', () => {
    const loginImg = document.getElementById('login-img');
    const loginForm = document.getElementById('login-form');
    const submitButton = document.getElementById('submit-button');
    const closeButton = document.getElementById('close-button');

    // 点击图片时显示登录表单
    loginImg?.addEventListener('click', () => {
      loginForm.style.display = 'flex'; // 显示表单
    });

    // 点击关闭按钮时隐藏登录表单
    closeButton?.addEventListener('click', () => {
      loginForm.style.display = 'none'; // 隐藏表单
    });

    // 提交登录表单的事件绑定
    submitButton?.addEventListener('click', () => {
      const username = document.getElementById('username')?.value;
      const password = document.getElementById('password')?.value;

      console.log('用户名:', username);
      console.log('密码:', password);

      // 提交数据到后端接口
      fetch('https://apifoxmock.com/m1/5804244-5489264-default/login', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          username: username,
          password: password,
        }),
      })
        .then((response) => response.json())
        .then((data) => {
          console.log('登录成功:', data);
          if (data.code === 200) {
            alert('登录成功！');
          } else {
            alert('登录失败！请检查用户名和密码');
          }
        })
        .catch((error) => {
          console.error('请求错误:', error);
          alert('发生了错误，请稍后再试');
        });

      // 提交后关闭表单
      loginForm.style.display = 'none';
    });
  });
</script>

<header
  class:list={[
    { sticky: isSticky, relative: !isSticky, dark: isDark },
    'top-0 z-40 flex-none mx-auto w-full  border-gray-50/0 transition-[opacity] ease-in-out',
  ]}
  {...isSticky ? { 'data-aw-sticky-header': true } : {}}
  {...id ? { id } : {}}
>
  <div class="absolute inset-0"></div>
  <div
    class:list={[
      'relative text-default py-3 px-3 md:px-6 mx-auto w-full',
      'w-[90%]',
      { 'md:flex md:justify-between': position !== 'center' },
      { 'md:grid md:grid-cols-2 md:items-center': position === 'center' },
    ]}
  >
    <div class:list={[{ 'mr-auto rtl:mr-0 rtl:ml-auto': position === 'right' }, 'flex justify-between']}>
      <a class="flex items-center" href={getHomePermalink()}>
        <Logo />
      </a>
      <div class="flex items-center md:hidden">
        <ToggleMenu />
      </div>
    </div>
    <div
      class:list={[
        { 'ml-auto rtl:ml-0 rtl:mr-auto': position === 'left' },
        'hidden md:self-center md:flex items-center md:mb-0 fixed w-full md:w-auto md:static justify-end left-0 rtl:left-auto rtl:right-0 bottom-0 p-1 md:p-0 md:justify-self-end',
      ]}
    >
      <div class="items-center flex justify-between w-full md:w-auto">
        <img src="../../src/assets/images/login.png" alt="login" id="login-img" class="cursor-pointer" />
      </div>
    </div>
  </div>
</header>

<!-- 登录表单（默认为显示） -->
<div
  id="login-form"
  class="fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center"
  style="backdrop-filter: blur(5px);"
>
  <div class="bg-[#262323] rounded-lg w-[545px] h-[380px] flex">
    <!-- 左侧图片区域，占2/5 -->
    <div class="w-[238px] h-full flex justify-center items-center">
      <img src="../../src/assets/images/login-img.png" alt="" class="object-fill w-full h-full" />
    </div>

    <!-- 右侧表单区域，占3/5 -->
    <div id="login-right" class="w-[307px] h-full flex flex-col justify-between items-center text-white px-4 py-6">
      <h2 class="text-lg font-medium">账号登录</h2>
      <div class="text-center text-sm text-[#949494] mb-4">推荐使用快捷登录，防止盗号风险</div>

      <!-- 用户名输入框 -->
      <div class="relative w-[220px] mb-3">
        <img src="../../src/assets/images/user-icon.png" alt="用户图标" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4" />
        <input
          type="text"
          placeholder="用户名"
          id="username"
          class="w-full p-1 pl-10 border rounded-md bg-[#262323] focus:ring-2 focus:ring-blue-500"
        />
      </div>

      <!-- 密码输入框 -->
      <div class="relative w-[220px] mb-3">
        <img src="../../src/assets/images/password-icon.png" alt="密码图标" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4" />
        <input
          type="password"
          placeholder="密码"
          id="password"
          class="w-full p-1 pl-10 border rounded-md bg-[#262323] focus:ring-2 focus:ring-blue-500"
        />
        <!-- 查看密码图标 -->
        <img
          src="../../src/assets/images/eye-icon.png"
          alt="查看密码"
          class="absolute right-3 top-1/2 transform -translate-y-1/2 cursor-pointer w-4 h-4"
          id="toggle-password"
        />
      </div>

      <!-- 登录按钮 -->
      <div
        id="submit-button"
        class="w-[220px] h-[40px] flex justify-center items-center cursor-pointer rounded-md bg-gradient-to-r from-[#1C80EB] to-[#40C6FF]"
      >
        <img src="../../src/assets/images/loginicon.png" alt="" class="w-4 h-4 mr-2" />
        <span class="text-sm">登录</span>
      </div>

      <!-- 忘记密码、注册表单切换 -->
      <div class="flex justify-between gap-2 w-[220px] text-xs mt-3 text-[#1D82EC]">
        <div id="show-register" class="cursor-pointer">账号注册</div>
        <div id="show-forgot" class="cursor-pointer">忘记密码？</div>
      </div>

      <!-- 第三方登录 -->
      <div class="flex justify-center gap-2 w-[220px] mt-4 text-xs">
        第三方快捷登录
      </div>
      <div class="flex justify-center gap-2 w-[220px] mt-4">
        <img src="../../src/assets/images/微信.png" alt="微信登录" class="w-6 h-6 cursor-pointer" />
        <img src="../../src/assets/images/QQ登录.png" alt="QQ登录" class="w-6 h-6 cursor-pointer" />
      </div>
    </div>
  </div>
</div>

<!-- 注册表单（默认为隐藏） -->
<div id="register-form" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center backdrop-blur">
  <div class="bg-[#262323] rounded-lg w-[545px] h-[380px] flex">
    <!-- 左侧图片区域，占2/5 -->
    <div class="w-[238px] h-full flex justify-center items-center">
      <img src="../../src/assets/images/login-img.png" alt="haib" class="object-fill  w-full h-full" />
    </div>

    <!-- 右侧表单区域，占3/5 -->
    <div id="register-right" class="w-[307px] h-full flex flex-col justify-between items-center text-white px-4 py-6">
      <h2 class="text-lg font-medium">注册账号</h2>
      <div class="text-center text-sm text-[#949494] mb-4">请输入您的信息来创建账号</div>

      <!-- 用户名输入框 -->
      <div class="relative w-[220px] mb-3">
        <img src="../../src/assets/images/user-icon.png" alt="用户图标" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4" />
        <input
          type="text"
          placeholder="用户名"
          id="register-username"
          class="w-full p-1 pl-10 border rounded-md bg-[#262323] focus:ring-2 focus:ring-blue-500"
        />
      </div>

      <!-- 密码输入框 -->
      <div class="relative w-[220px] mb-3">
        <img src="../../src/assets/images/password-icon.png" alt="密码图标" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4" />
        <input
          type="password"
          placeholder="密码"
          id="register-password"
          class="w-full p-1 pl-10 border rounded-md bg-[#262323] focus:ring-2 focus:ring-blue-500"
        />
        <!-- 查看密码图标 -->
        <img
          src="../../src/assets/images/eye-icon.png"
          alt="查看密码"
          class="absolute right-3 top-1/2 transform -translate-y-1/2 cursor-pointer w-5 h-5"
          id="register-toggle-password"
        />
      </div>

      <!-- 注册按钮 -->
      <div
        id="register-submit-button"
        class="w-[220px] h-[40px] flex justify-center items-center cursor-pointer rounded-md bg-gradient-to-r from-[#1C80EB] to-[#40C6FF]"
      >
        <span class="text-sm">注册</span>
      </div>

      <!-- 返回登录表单 -->
      <div class="text-xs text-[#1D82EC] mt-3 cursor-pointer" id="back-to-login">已有账号，返回登录</div>
    </div>
  </div>
</div>

<!-- 忘记密码表单（默认为隐藏） -->
<div id="forgot-password-form" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center backdrop-blur">
  <div class="bg-[#262323] rounded-lg w-[545px] h-[380px] flex">
    <!-- 左侧图片区域，占2/5 -->
    <div class="w-[238px] h-full flex justify-center items-center">
      <img src="../../src/assets/images/login-img.png" alt="haib" class="object-fill  w-full h-full" />
    </div>

    <!-- 右侧表单区域，占3/5 -->
    <div id="forgot-password-right" class="w-[307px] h-full flex flex-col justify-between items-center text-white px-4 py-6">
      <h2 class="text-lg font-medium">找回密码</h2>
      <div class="text-center text-sm text-[#949494] mb-4">请输入注册邮箱来重置密码</div>

      <!-- 邮箱输入框 -->
      <div class="relative w-[220px] mb-3">
        <img src="../../src/assets/images/user-icon.png" alt="邮箱图标" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4" />
        <input
          type="email"
          placeholder="手机号/邮箱"
          id="email"
          class="w-full p-1 pl-10 border rounded-md bg-[#262323] focus:ring-2 focus:ring-blue-500"
        />
      </div>

      <!-- 重置密码按钮 -->
      <div
        id="forgot-submit-button"
        class="w-[220px] h-[40px] flex justify-center items-center cursor-pointer rounded-md bg-gradient-to-r from-[#1C80EB] to-[#40C6FF]"
      >
        <span class="text-sm">修改密码</span>
      </div>

      <!-- 返回登录表单 -->
      <div class="text-xs text-[#1D82EC] mt-3 cursor-pointer" id="back-to-login-from-forgot">返回登录</div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const forgotPasswordForm = document.getElementById('forgot-password-form');
    const loginRight = document.getElementById('login-right');
    const registerRight = document.getElementById('register-right');
    const forgotPasswordRight = document.getElementById('forgot-password-right');

    // 切换到注册表单
    document.getElementById('show-register').addEventListener('click', () => {
      loginForm.style.display = 'none';
      registerForm.classList.remove('hidden');
    });

    // 切换到忘记密码表单
    document.getElementById('show-forgot').addEventListener('click', () => {
      loginForm.style.display = 'none';
      forgotPasswordForm.classList.remove('hidden');
    });

    // 返回到登录表单
    document.getElementById('back-to-login').addEventListener('click', () => {
      registerForm.classList.add('hidden');
      loginForm.style.display = 'flex';
    });

    // 返回到登录表单（忘记密码）
    document.getElementById('back-to-login-from-forgot').addEventListener('click', () => {
      forgotPasswordForm.classList.add('hidden');
      loginForm.style.display = 'flex';
    });
  });
</script>

